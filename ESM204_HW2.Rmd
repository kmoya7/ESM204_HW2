---
title: "ESM204_HW2"
author: "Katheryn Moya & Nickolas McManus"
date: "4/15/2022"
output: 
  html_document: 
    toc: yes
    toc_float: yes
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(here)
library(tidyverse)
library(equatiomatic)
library(broom)
```

```{r}
# read in data
water_districts <-read_csv(here("water_districts.csv"))
```
<br>

### Abatement Costs:

The marginal abatement cost is plotted for each irrigation district below. A linear regression model with zero intercept was added to each graph to indicate (something). (Maybe more explanatory text here). 


```{r}
# for each irrigation district, plot the marginal abatement cost data

## Katheryn: should "quantity of reduction" just be "abatement"?

## Kern County
ggplot(data = water_districts, aes(x = Reduction, y = MC_Kern)) +
  geom_point(color = "slateblue1", size = 1.6, alpha = 0.4) +
  geom_smooth(method = 'lm', color = "slateblue4")+
  labs(title = "Kern County Marginal Abatement Cost",
         x = "\nquantity of reduction (acre feet)",
         y = "marginal cost ($/acre foot)\n") +
  theme_bw() +
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    title = element_text(face = "bold"))

## Mojave County
ggplot(data = water_districts, aes(x = Reduction, y = MC_Mojave)) +
  geom_point(color = "slateblue1", size = 1.6, alpha = 0.4) +
  geom_smooth(method = 'lm', color = "slateblue4") +
  labs(title = "Mojave County Marginal Abatement Costs",
         x = "\nquantity of reduction (acre feet)",
         y = "marginal cost ($/acre foot)\n") +
  theme_bw() +
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    title = element_text(face = "bold"))

## Antelope County
ggplot(data = water_districts, aes(x = Reduction, y = MC_Antelope)) +
  geom_point(color = "slateblue1", size = 1.6, alpha = 0.4) +
  geom_smooth(method = 'lm', color = "slateblue4")+
  labs(title = "Antelope County Marginal Abatement Costs",
         x = "\nquantity of reduction (acre feet)",
         y = "marginal cost ($/acre foot)\n") +
  theme_bw() +
    theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    title = element_text(face = "bold"))

## Ventura County
ggplot(data = water_districts, aes(x = Reduction, y = MC_Ventura)) +
  geom_point(color = "slateblue1", size = 1.6, alpha = 0.4) +
  geom_smooth(method = 'lm', color = "slateblue4") +
  labs(title = "Ventura County Marginal Abatement Costs",
         x = "\nquantity of reduction (acre feet)",
         y = "marginal cost ($/acre foot)\n") +
  theme_bw() +
    theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    title = element_text(face = "bold"))
```

```{r}
# Linear regression model
kern_lm <- lm(MC_Kern ~ 0 + Reduction, data = water_districts)
summary(kern_lm)
kern_tidy <- tidy(kern_lm)
kern_tidy

mojave_lm <- lm(MC_Mojave ~ 0 + Reduction, data = water_districts)
summary(mojave_lm)
mojave_tidy <- tidy(mojave_lm)
mojave_tidy

antelope_lm <- lm(MC_Antelope ~ 0 + Reduction, data = water_districts)
summary(antelope_lm)
antelope_tidy <- tidy(antelope_lm)
antelope_tidy

ventura_lm <- lm(MC_Ventura ~ 0 + Reduction, data = water_districts)
summary(ventura_lm)
ventura_tidy <- tidy(ventura_lm)
ventura_tidy

```

```{r}
# get slopes

A = kern_lm$coefficient[1]
B = mojave_lm$coefficient[1]
C = antelope_lm$coefficient[1]
D = ventura_lm$coefficient[1]
```

```{r}
ggplot(data = water_districts, aes(x = Reduction,  y = MC_Kern)) +
  geom_smooth(method = "lm")
             
ggplot(data = water_districts, aes(x = Reduction,  y = MC_Mojave)) +
  geom_smooth(method = "lm")
             
ggplot(data = water_districts, aes(x = Reduction,  y = MC_Antelope)) +
  geom_smooth(method = "lm")
             
ggplot(data = water_districts, aes(x = Reduction,  y = MC_Ventura)) +
  geom_smooth(method = "lm")
             
```
Take zero-intercept and slope of curves to create marginal abatement curves

- Slope: Kern = 2.29, Mojave = 3.8, Antelope = 2.86, Ventura = 1.78 (all positive - demand curve is negative)
- We are provided with E0 (baseline): Kern = 150 AF, Mojave = 140 AF, Antelope = 220 AF, Ventura = 245 AF

- Derive demand curve from MA curve and plot all 4 onto the same graph -> learned how to do that in class #7

```{r}
# Plot all 4 demand curves onto the same graph

MB_Kern <- function(x) {343.5 - 2.29*x}
MB_Mojave <-  function(x) {532 - 3.8*x}
MB_Antelope <- function(x) {629.2 - 2.86*x}
MB_Ventura <- function(x) {436.1 - 1.78*x}


ggplot() + 
  xlim(0,245) + 
  ylim(0,600) +
  labs(title = "Predicted Marginal Benefit Curve", x = "Acre Foot", y = "$/Acre Foot", color = "Irrigation Districts") +
  geom_function(fun = MB_Kern , aes(color = "Kern")) +
  geom_function(fun = MB_Mojave, aes(color = "Mojave")) +
  geom_function(fun = MB_Antelope, aes(color = "Antelope")) +
  geom_function(fun = MB_Ventura, aes(color = "Ventura")) 
# Ventura is willing to pay the most for the first AF of water
#evaluate scenarios
#could be good to make D agg.
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
